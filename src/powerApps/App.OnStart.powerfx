//// â”€â”€ 0. ë‚ ì§œÂ·ìƒíƒœ ê¸°ë³¸ ë³€ìˆ˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//Set(varSelProject, "");
Set(varYear,  Year(Today()));
//Set(varMonth, Month(Today()));
Set(varFirstDayOfMonth, Date(Year(Today()), Month(Today()), 1));
Set(varSelectedDate, Today());
//Set(FilterStatus,  "ì§„í–‰ì¤‘");
Set(FilterMode,    "All");
Set(currentView,   "ì—…ë¬´ì¼ì§€");
Set(SelectedItem , {});
Set(varFilterMode, "All");
Set(varToastMessage, "");  Set(varShowToast , false);
Set(varToastMessage2,"");  Set(varShowToast2, false);

Set(varSelectedAccount, "");

Concurrent(
    /* 1) (êµ³ì´ í•„ìš” ì—†ë‹¤ë©´) ë³€ìˆ˜ë¥¼ ì—†ì• ë„ OK */
    Set(
        varCutoffDate,
        DateAdd(Today(), -365,TimeUnit.Days)
    ),

    /* 2) ë‚ ì§œë¥¼ ë‹¤ì‹œ ê³„ì‚°í•´ì„œ ì‚¬ìš© (ë…ë¦½) */
    ClearCollect(
        colMyTasks,
        ShowColumns(
            Filter(
                Task_DB,
                ì‘ì„±ì = varMyName,
                ì—…ë¬´_ì‹œì‘ì¼ì >= DateAdd(Today(), -365,TimeUnit.Days)
            ),
            ì—…ë¬´ì œëª©, ì—…ë¬´_ì‹œì‘ì¼ì, ìƒíƒœ, í”„ë¡œì íŠ¸ëª…
        )
    )
);



/* 2) ìƒíƒœ ì„ íƒ ì»¬ë ‰ì…˜ â€“ ê¸°ë³¸ ì „ë¶€ ì„ íƒ */
ClearCollect(
    colSelStatus,
    Table( {Value:"ì‹œì‘ì „"}, {Value:"ì§„í–‰ì¤‘"}, {Value:"ì™„ë£Œ"} )
);


/* â”€â”€â”€ ê¸°ì¡´ ì½”ë“œ ìœ„Â·ì•„ë˜ ì›í•˜ëŠ” ìœ„ì¹˜ì— ì¶”ê°€ â”€â”€â”€ */
Set(varShowPlanned,    false);   // ì‹œì‘ì „(Planned)   â†’ ê¸°ë³¸ OFF
Set(varShowInProgress, true );   // ì§„í–‰ì¤‘(InProgress)â†’ ê¸°ë³¸ ON
Set(varShowCompleted,  false);   // ì™„ë£Œ(Completed)   â†’ ê¸°ë³¸ OFF
 
//// â”€â”€ 1. ì‚¬ìš©ì ì •ë³´ (íšŒì‚¬ ë©”ì¼ì€ ëª¨ë‘ ì†Œë¬¸ì) â”€â”€â”€â”€â”€
Set(varMyEmail, Lower(User().Email));
 
/* 1-A) íŒ€ Â· ì´ë¦„ */
Set(
    varMyTeam,
    LookUp(
        UserInfo_DB,
        'e-mail' = varMyEmail,   // â† Email ì»¬ëŸ¼
        íŒ€                        // â† íŒ€ ì»¬ëŸ¼
    )
);
Set(
    varMyName,
    LookUp(
        UserInfo_DB,
        'e-mail' = varMyEmail,
        ì´ë¦„_í•œê¸€                  // â† í•œê¸€ ì´ë¦„ ì»¬ëŸ¼
    )
);
Set(varDisplayName, varMyName);
 
// â”€â”€ ìµœê·¼ 365ì¼ ê¸°ì¤€ì¼ (ì´ë¯¸ varCutoffDate ë§Œë“¤ê³  ìˆìœ¼ë‹ˆ ê·¸ê±¸ ì¨ë„ ë¨)
Set(varCutoffDate, DateAdd(Today(), -365, TimeUnit.Days));

// (ê¶Œì¥) ìµœì‹  ë°ì´í„° ë³´ì¥
Refresh(Daily_DB);

//// â”€â”€ 2. ìµœê·¼ 365ì¼ íŒ€ ë°ì´í„° â–¶ colDaily_365_Team â”€â”€â”€â”€â”€
ClearCollect(
    colDaily_365_Team,
    ShowColumns(
        Filter(
            Daily_DB,
            ì‘ì„±ì¼ì >= varCutoffDate &&
            íŒ€ = varMyTeam
        ),
        ID,
        ì‘ì„±ì¼ì,
        ì‘ì„±ì,
        íŒ€,
        í”„ë¡œì íŠ¸ëª…,
        ì—…ë¬´ì œëª©,
        ì‘ì—…ì‹œê°„,
        ìƒíƒœ,
        í”¼ë“œë°±
    )
);

//// â”€â”€ 2-B. ìµœê·¼ 365ì¼ ì „ì²´ ë°ì´í„° â–¶ colDaily_365_All â”€â”€â”€â”€â”€
ClearCollect(
    colDaily_365_All,
    ShowColumns(
        Filter(
            Daily_DB,
            ì‘ì„±ì¼ì >= varCutoffDate
        ),
        ID,
        ì‘ì„±ì¼ì,
        ì‘ì„±ì,
        íŒ€,
        í”„ë¡œì íŠ¸ëª…,
        ì—…ë¬´ì œëª©,
        ì‘ì—…ì‹œê°„,
        ìƒíƒœ,
        í”¼ë“œë°±
    )
);

//// â”€â”€ 3. í”„ë¡œì íŠ¸ ëª©ë¡ (ì •ê·œí™” + Value í†µì¼ + Blank ì œê±°) â”€â”€â”€â”€â”€

// ì •ê·œí™”: Trim + ê³µë°±ë¬¸ì(íŠ¹ìˆ˜ê³µë°± í¬í•¨) ì œê±°ê¹Œì§€ í•˜ê³  ì‹¶ìœ¼ë©´ Substituteë¥¼ í•œ ë‹¨ê³„ ë” ì“¸ ìˆ˜ ìˆìŒ
// ì¼ë‹¨ Trimë§Œìœ¼ë¡œë„ ëŒ€ë¶€ë¶„ í•´ê²°ë¨
ClearCollect(
    colProjectList,
    SortByColumns(
        RenameColumns(
            Filter(
                Distinct(
                    AddColumns(colDaily_365_Team, ProjNorm, Trim(OData__xd504__xb85c__xc81d__xd2b8__xba0)),
                    ProjNorm
                ),
                !IsBlank(Value)
            ),
            Value,
            Value
        ),
        "Value",
        SortOrder.Ascending
    )
);

ClearCollect(
    colAllProjects,
    SortByColumns(
        RenameColumns(
            Filter(
                Distinct(
                    AddColumns(colDaily_365_All, ProjNorm, Trim(OData__xd504__xb85c__xc81d__xd2b8__xba0)),
                    ProjNorm
                ),
                !IsBlank(Value)
            ),
           Value,
            Value
        ),
        "Value",
        SortOrder.Ascending
    )
);

// ê¸°ë³¸ ì„ íƒ: íŒ€ë³„ ì „ì²´ ì„ íƒ
Clear(colSelProjects);
Collect(colSelProjects, colProjectList.Value);


Set(varShowDetail, false);   // íŒì—… í‘œì‹œ ì—¬ë¶€
//Set(varSelID,     Blank());  // ì„ íƒëœ Daily_DB PK(ID)

// ë¡œê·¸ì¸ ì‚¬ìš©ì ì •ë³´ ìºì‹±
Set(
    varMyInfo,
    LookUp(UserInfo_DB, 'ì´ë¦„_í•œê¸€' = name_label.Text)
);
Set(varMyRole, varMyInfo.'ì§ê¸‰2');   // Choice íƒ€ì…ì´ë©´ .Value í•„ìˆ˜
Set(varMyDivision, varMyInfo.'ë¶€ë¬¸');
//Set(varMyTeam, varMyInfo.'íŒ€');
Set(varViewMode, "íŒ€ë³„");   // ğŸ”¸ ìƒˆ ì „ì—­ ë³€ìˆ˜ (ê¸°ë³¸ê°’: íŒ€ë³„)
